# Model Download Fallback System - Integration PRD

## STATUS: COMPLETE (pending external dependency)

### All Waves 1-4 Complete
- lib/model-downloader.js: 3-layer fallback (IPFS -> HuggingFace -> cache), 191 lines
- lib/download-metrics.js: metrics recording
- lib/file-verification.js: SHA-256 + size validation
- scripts/publish-models-to-ipfs.js: Pinata publishing script (requires API keys)
- server.js: ensureModelsDownloaded integrated with downloadWithFallback
- Metrics API endpoints live at /gm/api/metrics/downloads

### Wave 5 Verification Results (2026-02-21)
- Model files: 14/15 present (tokenizer.model missing, will download on server start via HuggingFace)
- SHA-256 hashes: 14/14 present files verified correct
- Manifest: valid at ~/.gmgui/models/.manifests.json
- Metrics file: valid at ~/.gmgui/models/.metrics.json
- GATEWAYS: restored to real Cloudflare/dweb.link/Pinata/ipfs.io gateways
- Server integration: downloadWithFallback called for every file in manifest

### IPFS Publishing - BLOCKED (external dependency)
- PINATA_API_KEY: NOT SET
- PINATA_SECRET_KEY: NOT SET
- Action required: sign up at https://www.pinata.cloud/, set env vars, run:
  node scripts/publish-models-to-ipfs.js
- After publishing: update database.js WHISPER_CID and TTS_CID with real CIDs
- Until keys available: system uses HuggingFace as primary fallback (works correctly)
